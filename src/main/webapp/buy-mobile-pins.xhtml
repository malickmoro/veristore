<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                template="/WEB-INF/template.xhtml">
    <f:metadata>
        <f:viewAction action="#{pinPurchaseView.prepareMobilePins}" />
    </f:metadata>
    <ui:define name="title">Mobile verification PINs â€“ Veristore</ui:define>
    <ui:define name="content">
        <div class="row justify-content-center g-5">
            <div class="col-12 col-xl-8 col-xxl-7">
                <h:form id="pinForm" prependId="true" styleClass="d-flex flex-column gap-4">
                    <h:messages id="messages"
                                showSummary="true"
                                showDetail="false"
                                layout="list"
                                styleClass="list-unstyled d-flex flex-column gap-3 mb-0"
                                globalOnly="true"
                                infoClass="alert alert-info alert-dismissible fade show mb-0"
                                warnClass="alert alert-warning alert-dismissible fade show mb-0"
                                errorClass="alert alert-danger alert-dismissible fade show mb-0"
                                fatalClass="alert alert-danger alert-dismissible fade show mb-0"
                                pt:role="alert" />

                    

                    <div class="product-detail-card">
                        <div class="card-body d-flex flex-column gap-4">
                            <div>
                                <h2 class="h4 fw-semibold mb-3">#{pinPurchaseView.stepOneTitle}</h2>
                                <p class="text-muted mb-4">#{pinPurchaseView.stepOneDescription}</p>
                                <div class="row g-3 align-items-end">
                                    <div class="col">
                                        <label class="form-label fw-semibold" for="pinForm:merchantCode">Merchant code</label>
                                        <h:inputText id="merchantCode"
                                                     value="#{pinPurchaseView.merchantCode}"
                                                     styleClass="form-control form-control-lg"
                                                     pt:placeholder="Enter merchant code"
                                                     required="true"
                                                     requiredMessage="Enter a merchant code." />
                                    </div>
                                    <div class="col-auto">
                                        <h:commandButton value="Search"
                                                         action="#{pinPurchaseView.searchMerchant}"
                                                         styleClass="btn btn-primary btn-lg rounded-4">
                                            <f:ajax execute="pinForm:merchantCode"
                                                    render="pinForm:messages pinForm:merchantCode pinForm:searchResults pinForm:stepTwo pinForm:addToCartButton" />
                                        </h:commandButton>
                                    </div>
                                </div>
                                <h:message for="merchantCode" styleClass="text-danger small mt-2 d-block" />
                            </div>

                            <h:panelGroup id="searchResults" layout="block">
                                <ui:fragment rendered="#{pinPurchaseView.lookupAttempted and not pinPurchaseView.merchantFound and not empty pinPurchaseView.merchantCode}">
                                    <div class="alert alert-danger mb-0" role="alert">
                                        No merchant found for code <strong>#{pinPurchaseView.merchantCode}</strong>. Check the code and try again.
                                    </div>
                                </ui:fragment>
                                <ui:fragment rendered="#{pinPurchaseView.merchantFound}">
                                    <div class="card border-0 bg-body-secondary">
                                        <div class="card-body">
                                            <p class="text-muted text-uppercase small mb-1">Merchant</p>
                                            <h3 class="h5 fw-semibold mb-1">#{pinPurchaseView.merchantName}</h3>
                                            <p class="text-muted small mb-0">#{pinPurchaseView.merchantLocation}</p>
                                        </div>
                                    </div>
                                    <ui:fragment rendered="#{pinPurchaseView.eligible}">
                                        <div class="alert alert-success mt-3 mb-0" role="status">
                                            #{pinPurchaseView.eligibilityMessage}
                                        </div>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{pinPurchaseView.merchantFound and not pinPurchaseView.eligible}">
                                        <div class="alert alert-warning mt-3 mb-0" role="status">
                                            #{pinPurchaseView.eligibilityMessage}
                                        </div>
                                    </ui:fragment>
                                </ui:fragment>
                            </h:panelGroup>
                        </div>
                    </div>

                    <h:panelGroup id="stepTwo" layout="block">
                        <ui:fragment rendered="#{pinPurchaseView.eligible}">
                            <div class="product-detail-card">
                                <div class="card-body">
                                    <h2 class="h4 fw-semibold mb-3">#{pinPurchaseView.stepTwoTitle}</h2>
                                    <p class="text-muted mb-4">#{pinPurchaseView.stepTwoDescription}</p>
                                    <div class="row g-4 align-items-start">
                                        <div class="col-12 col-md-6">
                                            <label class="form-label fw-semibold" for="pinForm:quantity">Quantity</label>
                                            <h:inputText id="quantity"
                                                         value="#{pinPurchaseView.qty}"
                                                         styleClass="form-control form-control-lg"
                                                         pt:type="number"
                                                         pt:min="1">
                                                <f:ajax event="change" render="pinForm:totalSummary" />
                                            </h:inputText>
                                            <h:message for="quantity" styleClass="text-danger small mt-2 d-block" />
                                        </div>
                                        <div class="col">
                                            <h:panelGroup id="totalSummary" layout="block">
                                                <div class="card border-0 bg-body-secondary h-100">
                                                    <div class="card-body">
                                                        <p class="text-muted text-uppercase small mb-2">Pricing</p>
                                                        <dl class="row small mb-0">
                                                            <dt class="col-6">Unit price</dt>
                                                            <dd class="col-6 text-end fw-semibold">#{pinPurchaseView.unitPriceFormatted}</dd>
                                                            <dt class="col-6">Quantity</dt>
                                                            <dd class="col-6 text-end">#{pinPurchaseView.qty}</dd>
                                                            <dt class="col-6">Total</dt>
                                                            <dd class="col-6 text-end fw-bold fs-5">#{pinPurchaseView.totalFormatted}</dd>
                                                        </dl>
                                                    </div>
                                                </div>
                                            </h:panelGroup>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ui:fragment>
                    </h:panelGroup>

                    <div class="d-flex flex-column flex-sm-row gap-3">
                        <h:panelGroup id="addToCartButton" layout="block">
                            <h:commandButton value="Add to cart"
                                             action="#{pinPurchaseView.addToCart}"
                                             styleClass="btn btn-primary btn-lg rounded-4"
                                             rendered="#{pinPurchaseView.eligible}">
                                <f:ajax execute="@form" render="pinForm:messages :cartToggle" />
                            </h:commandButton>
                        </h:panelGroup>
                        <h:link outcome="/index" styleClass="btn btn-outline-secondary btn-lg">Back to storefront</h:link>
                    </div>
                </h:form>
            </div>
        </div>
    </ui:define>
</ui:composition>
