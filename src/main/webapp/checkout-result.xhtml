<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template.xhtml">
    <f:metadata>
        <f:viewAction action="#{checkoutResultView.load}" />
    </f:metadata>
    <ui:define name="title">Checkout summary â€“ Veristore</ui:define>
    <ui:define name="content">
        <h:panelGroup rendered="#{checkoutResultView.missing}" layout="block" styleClass="text-center py-5">
            <h1 class="h3 mb-3">Checkout summary not available</h1>
            <p class="text-muted mb-4">We couldn't find details for this checkout. Start a new purchase from the storefront.</p>
            <div class="d-flex flex-column flex-sm-row gap-2 justify-content-center">
                <h:link outcome="/index" styleClass="btn btn-primary">Back to storefront</h:link>
            </div>
        </h:panelGroup>

        <h:panelGroup rendered="#{not checkoutResultView.missing}" layout="block">
            <section class="row justify-content-center" aria-labelledby="checkoutSummaryHeading">
                <div class="col-12 col-lg-10 col-xl-8">
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body p-4 p-lg-5">
                            <h1 id="checkoutSummaryHeading" class="h3 fw-bold mb-3">#{checkoutResultView.heading}</h1>
                            <p class="text-muted mb-4">#{checkoutResultView.introText}</p>

                            <ui:repeat value="#{checkoutResultView.lines}" var="line">
                                <div class="border rounded-3 p-3 mb-3">
                                    <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
                                        <div>
                                            <p class="text-uppercase small text-muted mb-1">#{line.referenceLabel}</p>
                                            <p class="fw-semibold mb-1">#{line.reference}</p>
                                            <p class="text-muted small mb-1">#{line.service}</p>
                                            <p class="text-muted small mb-0">Quantity: #{line.quantity}</p>
                                            <h:panelGroup rendered="#{line.hasStatus()}" layout="block" styleClass="mt-2">
                                                <span class="badge bg-light text-dark">#{line.status}</span>
                                            </h:panelGroup>
                                        </div>
                                        <div class="text-md-end">
                                            <p class="text-muted small mb-1">Total</p>
                                            <p class="fw-bold fs-5 mb-0">#{line.totalFormatted}</p>
                                        </div>
                                    </div>
                                    <h:panelGroup rendered="#{line.hasMaskedCodes()}" layout="block" styleClass="mt-3">
                                        <p class="text-muted small mb-2">Masked PINs</p>
                                        <div class="d-flex flex-wrap gap-2">
                                            <ui:repeat value="#{line.maskedCodes}" var="code">
                                                <span class="badge bg-light text-dark">#{code}</span>
                                            </ui:repeat>
                                        </div>
                                    </h:panelGroup>
                                </div>
                            </ui:repeat>

                            <h:panelGroup layout="block" styleClass="mt-4">
                                <h2 class="h6 text-uppercase text-muted mb-3">Totals</h2>
                                <ui:repeat value="#{checkoutResultView.totalsByCurrency.entrySet()}" var="total">
                                    <div class="d-flex justify-content-between small">
                                        <span class="text-muted">#{total.key}</span>
                                        <span class="fw-semibold">#{total.value}</span>
                                    </div>
                                </ui:repeat>
                            </h:panelGroup>

                            <div class="d-flex flex-column flex-sm-row gap-2 mt-4">
                                <h:link outcome="/history" styleClass="btn btn-outline-primary flex-fill">View order history</h:link>
                                <h:link outcome="/index" styleClass="btn btn-primary flex-fill">Back to storefront</h:link>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </h:panelGroup>
    </ui:define>
</ui:composition>
