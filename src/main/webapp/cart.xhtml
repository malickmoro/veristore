<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/template.xhtml">
    <ui:define name="title">Cart â€“ Veristore</ui:define>
    <ui:define name="content">
        <h:panelGroup layout="block" rendered="#{not cartView.hasItem()}" styleClass="text-center py-5">
            <span class="display-4 d-block mb-3" aria-hidden="true">ðŸ›’</span>
            <h2 class="h4 fw-semibold mb-2">Your cart is empty</h2>
            <p class="text-muted mb-4">Add a PIN package from any purchase track to begin checkout.</p>
            <div class="d-flex flex-wrap gap-3 justify-content-center">
                <h:link outcome="/buy-first-issuance" styleClass="btn btn-primary">Browse first issuance</h:link>
                <h:link outcome="/buy-verification" styleClass="btn btn-outline-primary">Shop verification</h:link>
            </div>
        </h:panelGroup>

        <h:panelGroup layout="block" rendered="#{cartView.hasItem()}" pt:aria-live="polite" pt:aria-atomic="true">
            <h:form id="cartForm" prependId="true" styleClass="row g-5 align-items-start">
                <div class="col-12 col-xl-7 col-xxl-8">
                    <div class="card shadow-sm">
                        <div class="card-body d-flex flex-column gap-3">
                            <div class="d-flex flex-column flex-lg-row justify-content-lg-between gap-3">
                                <div>
                                    <h2 class="h4 fw-semibold mb-1">#{cartView.currentItem.displayName()}</h2>
                                    <p class="text-muted mb-0">#{cartView.currentItem.description()}</p>
                                </div>
                                <div class="text-lg-end">
                                    <span class="badge bg-secondary-subtle text-secondary-emphasis">#{cartView.currentItem.mode().name() eq 'PAY_NOW' ? 'Pay now' : 'Invoice later'}</span>
                                </div>
                            </div>

                            <dl class="row small mb-0">
                                <dt class="col-sm-4">Unit price</dt>
                                <dd class="col-sm-8 fw-semibold">#{cartView.unitPriceFormatted}</dd>
                                <dt class="col-sm-4">Quantity</dt>
                                <dd class="col-sm-8">#{cartView.currentItem.quantity()}</dd>
                                <dt class="col-sm-4">Total</dt>
                                <dd class="col-sm-8 fw-bold">#{cartView.totalFormatted}</dd>
                                <dt class="col-sm-4">Email delivery</dt>
                                <dd class="col-sm-8">#{cartView.currentItem.delivery().byEmail() ? cartView.currentItem.contact().email() : 'Not requested'}</dd>
                                <dt class="col-sm-4">SMS delivery</dt>
                                <dd class="col-sm-8">#{cartView.currentItem.delivery().bySms() ? cartView.currentItem.contact().msisdn() : 'Not requested'}</dd>
                            </dl>
                        </div>
                    </div>

                    <div class="mt-4 d-flex flex-column flex-sm-row gap-3">
                        <h:commandButton value="Complete checkout"
                                         action="#{cartView.checkout}"
                                         styleClass="btn btn-dark btn-lg" />
                        <h:commandButton value="Clear cart"
                                         action="#{cartView.removeItem}"
                                         immediate="true"
                                         styleClass="btn btn-outline-secondary btn-lg" />
                    </div>
                </div>
                <div class="col-12 col-xl-5 col-xxl-4">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3 class="h6 text-uppercase text-muted mb-3">Delivery summary</h3>
                            <p class="small mb-2">We will send masked PINs using the channels you selected:</p>
                            <ul class="small list-unstyled mb-0">
                                <li>â€¢ Email: #{cartView.currentItem.delivery().byEmail() ? cartView.currentItem.contact().email() : 'Not requested'}</li>
                                <li>â€¢ SMS: #{cartView.currentItem.delivery().bySms() ? cartView.currentItem.contact().msisdn() : 'Not requested'}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </h:form>
        </h:panelGroup>
    </ui:define>
</ui:composition>
