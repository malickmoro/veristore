<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                template="/WEB-INF/template.xhtml">
    <ui:define name="title">Order history</ui:define>
    <ui:define name="content">
        <section class="mb-5" aria-labelledby="historyHeading">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-10 col-xl-8">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-4 p-lg-5">
                            <h1 id="historyHeading" class="h3 fw-bold mb-3">Lookup past orders</h1>
                            <p class="text-muted mb-4">Search using the email or phone number used during checkout. We only display masked PINs for your security.</p>
                            <h:form id="historyForm" class="row g-3 align-items-end">
                                <div class="col-12 col-md-5">
                                    <h:outputLabel for="email" value="Email" styleClass="form-label" />
                                    <h:inputText id="email"
                                                 value="#{historyView.email}"
                                                 pt:type="email"
                                                 styleClass="form-control" />
                                </div>
                                <div class="col-12 col-md-5">
                                    <h:outputLabel for="msisdn" value="Phone number" styleClass="form-label" />
                                    <h:inputText id="msisdn"
                                                 value="#{historyView.msisdn}"
                                                 styleClass="form-control" />
                                </div>
                                <div class="col-12 col-md-2 d-grid">
                                    <h:commandButton value="Search"
                                                     styleClass="btn btn-primary"
                                                     action="#{historyView.search}" />
                                </div>
                            </h:form>

                            <h:panelGroup rendered="#{historyView.searched and not empty historyView.results}" layout="block" styleClass="mt-4">
                                <div class="table-responsive">
                                    <table class="table table-sm align-middle">
                                        <thead>
                                        <tr>
                                            <th scope="col">Reference</th>
                                            <th scope="col">Service</th>
                                            <th scope="col">Quantity</th>
                                            <th scope="col">Total</th>
                                            <th scope="col">Issued</th>
                                            <th scope="col">PINs</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <ui:repeat value="#{historyView.results}" var="order">
                                            <tr>
                                                <td>#{order.id}</td>
                                                <td>#{historyView.describeService(order)}</td>
                                                <td>#{order.qty}</td>
                                                <td>#{historyView.formatTotal(order)}</td>
                                                <td><h:outputText value="#{order.created}">
                                                    <f:convertDateTime type="localDateTime" pattern="yyyy-MM-dd HH:mm" />
                                                </h:outputText></td>
                                                <td>
                                                    <ui:repeat value="#{historyView.maskedCodes(order)}" var="code">
                                                        <span class="badge bg-light text-dark me-1 mb-1">#{code}</span>
                                                    </ui:repeat>
                                                </td>
                                            </tr>
                                        </ui:repeat>
                                        </tbody>
                                    </table>
                                </div>
                            </h:panelGroup>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </ui:define>
</ui:composition>
